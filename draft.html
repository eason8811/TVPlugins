<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Rectangle on Canvas</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="500" height="400"></canvas>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        // 初始矩形参数
        let rect = { x: 100, y: 100, width: 200, height: 150 };
        const cornerSize = 10;
        let draggingCorner = null;
        let isDragging = false;

        // 绘制背景（覆盖之前的绘图内容）
        function drawBackground() {
            ctx.fillStyle = 'white'; // 背景颜色，可以更改为其他颜色或图像
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // 绘制矩形和角点
        function draw() {
            drawBackground(); // 先绘制背景，覆盖之前的内容

            ctx.fillStyle = 'rgba(0, 150, 250, 0.5)';
            ctx.fillRect(rect.x, rect.y, rect.width, rect.height);

            // 画矩形的四个角点，用于缩放
            ctx.fillStyle = 'rgba(255, 0, 0, 1)';
            ctx.fillRect(rect.x - cornerSize / 2, rect.y - cornerSize / 2, cornerSize, cornerSize); // 左上
            ctx.fillRect(rect.x + rect.width - cornerSize / 2, rect.y - cornerSize / 2, cornerSize, cornerSize); // 右上
            ctx.fillRect(rect.x - cornerSize / 2, rect.y + rect.height - cornerSize / 2, cornerSize, cornerSize); // 左下
            ctx.fillRect(rect.x + rect.width - cornerSize / 2, rect.y + rect.height - cornerSize / 2, cornerSize, cornerSize); // 右下
        }

        // 检查鼠标是否在角点上
        function isMouseInCorner(mouseX, mouseY) {
            const corners = [
                { x: rect.x, y: rect.y }, // 左上
                { x: rect.x + rect.width, y: rect.y }, // 右上
                { x: rect.x, y: rect.y + rect.height }, // 左下
                { x: rect.x + rect.width, y: rect.y + rect.height } // 右下
            ];

            for (let i = 0; i < corners.length; i++) {
                const corner = corners[i];
                if (mouseX > corner.x - cornerSize / 2 &&
                    mouseX < corner.x + cornerSize / 2 &&
                    mouseY > corner.y - cornerSize / 2 &&
                    mouseY < corner.y + cornerSize / 2) {
                    return i; // 返回角点的索引
                }
            }
            return null;
        }

        // 处理鼠标按下事件
        canvas.addEventListener('mousedown', (e) => {
            const mousePos = { x: e.offsetX, y: e.offsetY };
            draggingCorner = isMouseInCorner(mousePos.x, mousePos.y);
            if (draggingCorner !== null) {
                isDragging = true;
            }
        });

        // 处理鼠标移动事件
        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && draggingCorner !== null) {
                const mousePos = { x: e.offsetX, y: e.offsetY };
                switch (draggingCorner) {
                    case 0: // 左上角
                        rect.width += rect.x - mousePos.x;
                        rect.height += rect.y - mousePos.y;
                        rect.x = mousePos.x;
                        rect.y = mousePos.y;
                        break;
                    case 1: // 右上角
                        rect.width = mousePos.x - rect.x;
                        rect.height += rect.y - mousePos.y;
                        rect.y = mousePos.y;
                        break;
                    case 2: // 左下角
                        rect.width += rect.x - mousePos.x;
                        rect.x = mousePos.x;
                        rect.height = mousePos.y - rect.y;
                        break;
                    case 3: // 右下角
                        rect.width = mousePos.x - rect.x;
                        rect.height = mousePos.y - rect.y;
                        break;
                }
                draw();
            }
        });

        // 处理鼠标释放事件
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            draggingCorner = null;
        });

        draw();
    </script>
</body>
</html>
